# weather-map-leaflet-mongodb

Weather map dashboard for Indonesia powered by LeafletJS, OpenMeteo, and MongoDB.

## Architecture Overview

- **Data collectors** (`openmeteo/update_city_weather.py`, `openmeteo/fetch_weather_data.py`, `pelabuhan/pelabuhan_weather.py`) fetch weather data and store it in MongoDB collections (`city_weather`, `grid_weather`, `port_weather`).
- **Weather API server** (`openmeteo/weather_api_server.py`) exposes REST endpoints that read directly from MongoDB and also serves the static Leaflet app.
- **Leaflet frontend** (`index.html`) consumes `/api/weather/{city|grid|port}` through a smart cache manager instead of bundling large `.json` files.

## Getting Started

1. **Install dependencies**
   ```bash
   pip install -r openmeteo/requirements.txt
   ```

2. **Configure environment** (copy `.env.example` to `.env` and adjust):
   ```ini
   MONGO_URI=mongodb://localhost:27017
   MONGO_DB=weather_map
   CITY_COLLECTION=city_weather
   GRID_COLLECTION=grid_weather
   PORT_COLLECTION=port_weather
   WEATHER_API_HOST=0.0.0.0
   WEATHER_API_PORT=8000
   ```

3. **Run collectors** (examples):
   ```bash
   python openmeteo/update_city_weather.py
   python openmeteo/fetch_weather_data.py
   python pelabuhan/pelabuhan_weather.py
   ```

4. **Start the API + static server**
   ```bash
   python openmeteo/weather_api_server.py
   ```
   Visit `http://localhost:8000` to open the Leaflet dashboard, which now fetches data live from MongoDB via the API endpoints.

## API Endpoints

| Endpoint                | Description                |
|-------------------------|----------------------------|
| `/api/weather/city`     | List of city weather docs  |
| `/api/weather/grid`     | List of 1Â° grid weather    |
| `/api/weather/port`     | List of port weather docs  |
| `/api/weather/all`      | Combined payload           |
| `/api/weather/summary`  | Latest timestamps + counts |

All responses are JSON and already normalized for the Leaflet UI.

## Notes

- Legacy `.json` exports are no longer generated by default. MongoDB is the canonical source.
- If you still need static snapshots (for offline usage), run an export script that reads Mongo and writes to files before serving them.
